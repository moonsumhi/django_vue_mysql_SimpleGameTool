{% extends 'base.html' %}
{% block title %}Django - Vue - MySQL{% endblock %}

{% block extra-style %}
    <style>
        body {
            text-align: center;
            background-color: #ddd;
        }
        .user_row:hover{
            background-color:#fefefe;
        }
        .removeBtn {
            margin-left: auto;
            font-size: 20px;
        }
        .removeBtn:hover{
            color: red;
        }
    </style>
{% endblock %}

{% block content %}
<div id='app'>

    <h1>게임 유저 검색</h1>
    <br>

    <div class="input-group mb-3">
      <input type="text" class="form-control" placeholder="ID" v-model.trim="user_id"
          v-on:keyup.enter="search_user()">
      <button class="btn btn-outline-secondary" v-on:click="search_user(user_id)">search</button>
    </div>

    <br>
    <h3>검색 결과</h3>
    <br>

    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Name</th>
          <th scope="col">Created at</th>
          <th scope="col">Gold</th>
          <th scope="col">Level</th>
          <th scope="col">Inventory</th>
        </tr>
      </thead>
      <tbody>
        <tr class="user_row" v-on:click="detail_user(user_id)">
          <th scope="row">[[ user_info.user_id ]]</th>
          <td>[[ user_info.name ]]</td>
          <td>[[ user_info.created_at ]]</td>
          <td>[[ user_info.gold ]]</td>
          <td>[[ user_info.level ]]</td>
          <td>[[ user_info.inventory ]]</td>
        </tr>
      </tbody>
    </table>

    <table class="table table-dark" v-show="detail_show">
      <thead class="thead-dark">
        <tr>
          <th scope="col">이름</th>
          <th scope="col">값</th>
          <th scope="col">액션</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"> user_id </th>
          <td>[[ user_info.user_id ]]</td>
          <td><button class="btn btn-info btn-sm">수정</button></td>
        </tr>
        <tr>
          <th scope="row"> name </th>
          <td>[[ user_info.name ]]</td>
          <td><button class="btn btn-info btn-sm">수정</button></td>
        </tr>
        <tr>
          <th scope="row"> gold </th>
          <td>[[ user_info.gold ]]</td>
          <td><button class="btn btn-info btn-sm">수정</button></td>
        </tr>
        <tr>
          <th scope="row"> level </th>
          <td>[[ user_info.level ]]</td>
          <td><button class="btn btn-info btn-sm">수정</button></td>
        </tr>
        <tr>
          <th scope="row"> inventory </th>
          <td>[[ user_info.inventory ]]</td>
          <td><button class="btn btn-info btn-sm">수정</button></td>
        </tr>
      </tbody>
    </table>

</div>
{% endblock %}

{% block extra-script %}
<script src="https://unpkg.com/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

    axios.defaults.xsrfCookieName = 'csrftoken';
    axios.defaults.xsrfHeaderName = 'X-CSRFToken';

    var vm = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            user_id: '',
            user_info: {},
            detail_show: false,
        },
        methods: {
            search_user: function(user_id){
              console.log("search_user()...");
              if (user_id == '') return;

              var vm = this;
              axios.get('/users/ids/'+ user_id + '/')
                  .then(function(res){
                    console.log("SEARCH GET RES", res);
                    vm.user_info = res.data;
                  })
                  .catch(function(err){
                    console.log("SEARCH ERR", err);
                  })
            },
            detail_user:function(user_id){
              if (this.detail_show == false){
                this.detail_show = true;
              }
              else{
                this.detail_show = false;
              }
            },
        },

    })
</script>
{% endblock %}
